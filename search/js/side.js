/* * 쿼리로그 적재 / 내가 찾은 검색어 / 자동완성 / 추천검색어 / 연관검색어 / 테마검색 / 실시간(급상승)검색어 / 인기검색어. *//* * 쿼리로그 적재. * param : query(String), index(String), count(number) * return : N/A */function querylogStack(query, index, count) {    // ajax에서 .do 호출 할 url : '/site/rest' (String)    let url = def.url;    // ajax에 사용할 contentType : 'application/x-www-form-urlencoded;charset=UTF-8' (String)    let contentType = def.contentType;    // openquery와 연동할 url : 'http://IP:8540/gateway/_querylog' (String)    let gatewayUrl = def.gatewayIpPort + '/gateway/_querylog';    // 검색 결과 개수 (number)    let gatewayTotal = count;    // 검색 결과 응답 시간 (number)    let gatewayTook = $("#esDataTemp").val();    // index가 total이면 *로 치환해서 ES에 적재.    if (index == 'total') {        index = '*';    }    // gateway에 전달 시, 한글 깨짐 방지 (String)    let acQuery = decodeURI(query);    // ajax로 넘길 데이터 지정.    let gatewayData = {        "index": index,        "query": acQuery,        "total": gatewayTotal,        "took": gatewayTook    };    // 통신해서 데이터 가져오기    $.ajax({        url: url,        type: 'POST',        data: {            requestMethod: 'POST',            esUrl: gatewayUrl,            objData: JSON.stringify(gatewayData), // gatewayData 객체를 String으로 형변환하여 넘김.            uriQuery: "#querylog#"        },        contentType: contentType,        async: false    });} /// end querylogStak()/* * 연관검색어. * 자동완성의 데이터를 연관검색어 쪽에 뿌려주기로 함 * param : N/A * return : N/A */function related() {    // _sToken    //let _sToken = $('input[name=_sToken]').val();    // ajax에서 .do 호출 할 url : '/site/rest' (String)    let url = def.url;    // ajax에 사용할 contentType : 'application/x-www-form-urlencoded;charset=UTF-8' (String)    let contentType = def.contentType;    let query = $('.searchQuery').val();	query = query.replace(/%/gi, '');	query = query.replace(/</gi, '');	query = query.replace(/>/gi, '');    // gateway에 전달 시, 한글 깨짐 방지 (String)    let acQuery = encodeURI(query);    // openquery의 autocomplete와 연동할 url 및 param (String)    let gatewayUrl = def.gatewayIpPort + '/service/autocomplete?keyword=' + acQuery + '&sort=weight';    // ajax로 가져온 data를 받음 (Array)    let resultArr = new Array();    // 화면에 뿌려질 html (String)    let html = '';    // 연관검색어 데이터 가져오기.    $.ajax({        url: url,        type: 'POST',        contentType: contentType,        data: {            requestMethod: 'GET',            esUrl: gatewayUrl,            objData: "",            uriQuery: ""        },        async: false,        success: function(data) {			if(data == '[]') {				html += '<span><a href="javascript:void(0)" onClick="javascript:acSearch(\'마포\'); return false;">마포</a></span>';				html += '<span><a href="javascript:void(0)" onClick="javascript:acSearch(\'마포구청\'); return false;">마포구청</a></span>';				html += '<span><a href="javascript:void(0)" onClick="javascript:acSearch(\'민방위\'); return false;">민방위</a></span>';				html += '<span><a href="javascript:void(0)" onClick="javascript:acSearch(\'교육\'); return false;">교육</a></span>';				html += '<span><a href="javascript:void(0)" onClick="javascript:acSearch(\'복지\'); return false;">복지</a></span>';			} else {				resultArr = JSON.parse(data);								for (var i in resultArr) {					html += '<span><a href="javascript:void(0)" onClick="javascript:acSearch(\'' + resultArr[i].keyword + '\'); title="새창열림" return false; ">' + resultArr[i].keyword + '</a></span>';				} /// end for			}			$('#relatedUI').html(html);        },        error: function(err) {			$('#relatedUI').html('');            console.error("err : " + err);        }    });} /// end related()/* * 테마검색. * param : N/A * return : N/A */function theme() {    // _sToken    //let _sToken = $('input[name=_sToken]').val();    // input에 담긴 query를 가져옴 (String)    let query = $('.searchQuery').val();	query = query.replace(/%/gi, '');	query = query.replace(/</gi, '');	query = query.replace(/>/gi, '');    // ajax에서 .do 호출 할 url : '/site/rest' (String)    let url = def.url;    // ajax에 사용할 contentType : 'application/x-www-form-urlencoded;charset=UTF-8' (String)    let contentType = def.contentType;    // gateway에 전달 시, 한글 깨짐 방지 (String)    let acQuery = encodeURI(query);    // openquery의 theme와 연동할 url 및 param (String)    let gatewayUrl = def.gatewayIpPort + '/service/theme?keyword=' + acQuery;    // 화면에 뿌려질 html (String)    let html = '';    // 테마검색 데이터 가져오기.    $.ajax({        url: url,        type: 'POST',        contentType: contentType,        data: {            requestMethod: 'GET',            esUrl: gatewayUrl,            objData: "",            uriQuery: ""        },        async: false,        success: function(data) {            let dataTemp = '';            if (data == null || data == '' || data == undefined || data == 0) {				$('.themeUI').html('');                return false;            } else {                // 테마검색 대상일 경우.                html = data;				$('.themeUI').html(html);            }        },        error: function(err) {			$('.themeUI').html('');            // 테마검색 대상이 아닐 경우.            console.error("err : " + JSON.stringify(err, null, 2));            return false;        }    });} /// end theme()/* * 실시간(급상승)검색어. * param : N/A * return : N/A */function hotQuery() {    // _sToken    //let _sToken = $('input[name=_sToken]').val();    // input에 담긴 query를 가져옴 (String)    let query = $('.searchQuery').val();    // ajax에서 .do 호출 할 url : '/site/rest' (String)    let url = def.url;    // ajax에 사용할 contentType : 'application/x-www-form-urlencoded;charset=UTF-8' (String)    let contentType = def.contentType;    // openquery의 hotquery와 연동할 url 및 param (String)    let gatewayUrl = def.gatewayIpPort + '/service/hotquery?label=hotquery';    // ajax로 가져온 data를 받음 (Array)    let resultArr = new Array();    // 화면에 뿌려질 html (String)    let html = '';    // 실시간(급상승)검색어 데이터 가져오기.    $.ajax({        url: url,        type: 'POST',        contentType: contentType,        data: {            requestMethod: 'GET',            esUrl: gatewayUrl,            objData: "",            uriQuery: ""        },        async: false,        success: function(data) {			if(data == '[]') {				html += '<li><span class="num">1</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'마포구청\'); return false;" class="kwtxt">마포구청</a><span class="arr arr_new" style="color:red;">N</span></li>';				html += '<li><span class="num">2</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'마포\'); return false;" class="kwtxt">마포</a><span class="arr arr_up"></span></li>';				html += '<li><span class="num">3</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'민방위\'); return false;" class="kwtxt">민방위</a><span class="arr arr_down"></span></li>';				html += '<li><span class="num">4</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'교육\'); return false;" class="kwtxt">교육</a><span class="arr arr_new" style="color:red;">N</span></li>';				html += '<li><span class="num">5</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'SNS\'); return false;" class="kwtxt">SNS</a><span class="arr"></span></li>';				html += '<li><span class="num">6</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'민원\'); return false;" class="kwtxt">민원</a><span class="arr arr_down"></span></li>';				html += '<li><span class="num">7</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'교육강좌\'); return false;" class="kwtxt">교육강좌</a><span class="arr arr_new" style="color:red;">N</span></li>';				html += '<li><span class="num">8</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'여권\'); return false;" class="kwtxt">여권</a><span class="arr arr_up"></span></li>';				html += '<li><span class="num">9</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'관광\'); return false;" class="kwtxt">관광</a><span class="arr arr_new" style="color:red;">N</span></li>';				html += '<li><span class="num">10</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'열린행정\'); return false;" class="kwtxt">열린행정</a><span class="arr arr_new" style="color:red;">N</span></li>';			} else {				let dataTemp = JSON.parse(data);				resultArr = dataTemp;								// 데이터 화면에 뿌리기.				$.each(resultArr, function(index, item) {					html += '<li><span class="num">';					html += item.rank; // 화면에 출력되는 순위.					html += '</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'';					html += item.query; // acSearch()에 사용되는 query					html += '\'); return false;" class="kwtxt">';					html += item.query; // 화면에 출력되는 query					html += '</a><span class="arr';					if (item.updown == 'up') { // 검색어 상승 화살표.						html += ' arr_up">';					} else if (item.updown == 'down') { // 검색어 하락 화살표.						html += ' arr_down">';					} else if (item.updown == 'new') { // new!						html += ' arr_new" style="color:red;">N';					} else {						html = html + '">'; // 검색어 그대로.					}					html += '</span></li>';				});			}			$('#hotQueryUI').html(html);        },        error: function(err) {			$('#hotQueryUI').html('');            console.error("err : " + err);        }    });} /// end hotQuery()/* * 인기 검색어. * param : N/A * return : N/A */function popQuery() {    // _sToken    //let _sToken = $('input[name=_sToken]').val();    // input에 담긴 query를 가져옴 (String)    let query = $('.searchQuery').val();    // ajax에서 .do 호출 할 url : '/site/rest' (String)    let url = def.url;    // ajax에 사용할 contentType : 'application/x-www-form-urlencoded;charset=UTF-8' (String)    let contentType = def.contentType;    // openquery의 popquery와 연동할 url 및 param (String)    let gatewayUrl = def.gatewayIpPort + '/service/popquery?label=';    // all:익일 / week:전주 / month:전월 대상 (array)    let gubun = ['all', 'week', 'month'];    // ajax로 가져온 data를 받음 (Array)    let resultArr = null;    // 화면에 뿌려질 html (String)    let html = '';    // 익일 / 전주 / 전월 차례대로 한번씩 돈다.    for (var i in gubun) {        // html에 담을 임시 데이터        let htmlTemp = '<ul class="kwbox">';        // 인기검색어 데이터 가져오기.        $.ajax({            url: url,            type: 'POST',            contentType: contentType,            data: {                requestMethod: 'GET',                esUrl: gatewayUrl + gubun[i],                objData: "",                uriQuery: "#popQuery#"            },            async: false,            success: function(data) {                let dataTemp = '';                // 데이터 없을 때 출력하는 html.                if (data == null || data == '' || data == undefined) {                    htmlTemp += '<li><span class="num">1</span><a href="" class="kwtxt">-</a><span class="arr">변경없음</span></li>';                } else {                    dataTemp = JSON.parse(data);                }                resultArr = dataTemp;								for (var i in resultArr) {					let decodeQuery = decodeURI(resultArr[i].query);					htmlTemp += '<li><span class="num">';					htmlTemp += resultArr[i].rank;					htmlTemp += '</span><a href="javascript:void(0);" onClick="javascript:acSearch(\'';					htmlTemp += decodeQuery;					htmlTemp += '\'); return false;" class="kwtxt">';					htmlTemp += decodeQuery;					htmlTemp += '</a><span class="arr';					if (resultArr[i].updown == 'up') { // 검색어 상승 화살표.						htmlTemp += ' arr_up">상승';					} else if (resultArr[i].updown == 'down') { // 검색어 하락 화살표.						htmlTemp += ' arr_down">하락';					} else if (resultArr[i].updown == 'new') { // new!						htmlTemp += 'arr_new" style="color:red;">N';					} else {						htmlTemp += '">변경없음'; // 검색어 그대로.					}					htmlTemp += '</span></li>';				}				htmlTemp += '</ul>';				html += htmlTemp;            },            error: function(err) {                console.error("err : " + err);            }        });    } /// end for	    $('#popQueryUI').html(html);} /// end popQuery()/* * 자동완성. * param : query(String) * return : N/A * etc: javascript파일 내부에 넣어놓으면, I.E에서 인식을 못해서 빼놓음... */function autoComplete(query) {	// 5자만 넘어가도 자동완성은 나오지 않음	if(query.length > 7) {		return false;	}	query = query.replace(/%/gi, '');	query = query.replace(/</gi, '&lt;');	query = query.replace(/>/gi, '&gt;');	    // _sToken    //let _sToken = $('input[name=_sToken]').val();    // ajax에서 .do 호출 할 url : '/site/rest' (String)    let url = def.url;    // ajax에 사용할 contentType : 'application/x-www-form-urlencoded;charset=UTF-8' (String)    let contentType = def.contentType;    // gateway에 전달 시, 한글 깨짐 방지 (String)    let acQuery = encodeURI(query);    // openquery의 autocomplete와 연동할 url 및 param (String)    let gatewayUrl = def.gatewayIpPort + '/service/autocomplete?keyword=' + acQuery + '&sort=weight';    // ajax로 가져온 data를 받음 (Array)    let resultArr = new Array();    // 화면에 뿌려질 html (String)    let html = '';    // 자동완성 데이터 가져오기.    $.ajax({        url: url,        type: 'POST',        contentType: contentType,        data: {            requestMethod: 'GET',            esUrl: gatewayUrl,            objData: "",            uriQuery: ""        },        async: false,        success: function(data) {            resultArr = JSON.parse(data);						// 데이터 화면에 뿌리기.			$.each(resultArr, function(index, item) {				html += '<li class="acClass"><a href="javascript:void(0);" onClick="javascript:acSearch(\'';				html += ((item.highlight).replace(/¶HS¶/gi, '')).replace(/¶HE¶/gi, ''); // acSearch()에 사용될 param				html += '\');"><span class="acText">';				html += ((item.highlight).replace(/¶HS¶/gi, '<HS>')).replace(/¶HE¶/gi, '</HS>'); // 화면에 보여질 data				html += '</span></a></li>';			});			$('#autoCompleteUI').html(html);        },        error: function(err) {			$('#autoCompleteUI').html('');            console.error("err : " + err);        }    });} /// end autoComplete()/* * 내가 찾은 검색에서 검색하기 * param : query(String) * return : N/A * etc: javascript파일 내부에 넣어놓으면, I.E에서 인식을 못해서 빼놓음... */function myFindSearch(query) {    // 검색(doSearch)에서 사용할 query 저장.    $(".searchQuery").val(query);    // selectbox 및 tab을 통합검색(9)으로 변경.    $("#menuOpt").val(9).prop("selected", true);    $(".pc li").attr('class', '');    $("#menu9").attr('class', 'on');    // 검색.    doSearch();} /// end myFindSearch()/* * 내가 찾은 검색어 조회. * param : paramQuery(String) * return : N/A * etc: javascript파일 내부에 넣어놓으면, I.E에서 인식을 못해서 빼놓음... */function getMyFindKeyword(paramQuery) {	let query = paramQuery;	let ls = window['localStorage'];	let isDup = false;	let dupNum = 0;	let lslength = ls.length;    // query null체크.    if (query == '' || query == null || query.length == 0) {        return false;    } else { // 로컬스토리지 설정.    	// 중복 여부 확인    	for(var i=1; i<=lslength; i++) {    		if(query == ls.getItem(i)) {    			isDup = true;    			dupNum = i;    		}    	}    	    	// 데이터 삽입       	for(var i=1; i<=6; i++) {       		// 데이터 중복 났을 때       		if(isDup) {       			let dupArr = new Array();       			       			for(var j=1; j<=lslength; j++) {       				dupArr.push(ls.getItem(j));       			}       			       			dupArr.splice(dupNum-1, 1);       			dupArr.push(query);       			       			for(var j=0; j<dupArr.length; j++) {       				ls.setItem(j+1, dupArr[j]);       			}       			       			break;       		} else { // 데이터 중복 아닐 때           		// 데이터 꽉 찼을 때           		if(i == 6) {           			for(var j=1; j<=4; j++) {           				ls.setItem(j, ls.getItem(j+1));           			}           			ls.setItem(5, query);           			break;           		} else {               		// 데이터 삽입               		if(ls.getItem(i) == null) {               			ls.setItem(i, query);               			break;               		} else {                   		continue;               		}           		}       		}       	}     }		showMyFindKeyword();} /// end getMyFindKeyword()/* * 내가 찾은 검색어 뿌려주기. * param :  * return : N/A * etc: javascript파일 내부에 넣어놓으면, I.E에서 인식을 못해서 빼놓음... */function showMyFindKeyword() {	// 내가 찾은 검색어 출력	let ls = window['localStorage'];	let html = "";		html += "<ul class='mykeyword'>";		for(var i=5; i>=1; i--) {		if(ls.getItem(i) == null || ls.getItem(i) == undefined) continue;		        html += '<li class="searchkey"><a href="#" onClick="javascript:myFindSearch(\'';        html += ls.getItem(i); // myFindSearch() 실행 시 필요한 param(query)        html += '\');">';        html += ls.getItem(i); // 화면에 출력될 때 필요한 query        html += '</a>&nbsp;&nbsp;<a class="btn_del"><img src="/search/images/ico_del.gif"';        html += ' alt="" onClick="javascript:delMyFindKeyword(\''        html += i; // delMyFindKeyword() 실행 시 필요한 param(query)        html += '\');"></a></li>';	}        html += "</ul>";    $("#mykeyword").html(html);} /// end showMyFindKeyword()/* * 내가 찾은 검색어 삭제. * param : query() * return : N/A * etc: javascript파일 내부에 넣어놓으면, I.E에서 인식을 못해서 빼놓음... */function delMyFindKeyword(lsIndex) {	let ls = window['localStorage'];	let lslength = ls.length;	let arr = new Array();		for(var i=1; i<=lslength; i++) {		arr.push(ls.getItem(i));	}		arr.splice(lsIndex-1, 1);		ls.clear();		for(i=0; i<arr.length; i++) {		ls.setItem(i+1, arr[i]);	}		showMyFindKeyword();} /// end delMyFindKeyword()/* * 추천검색어. * 추천검색어지만 [연관검색어]의 데이터를 가져오도록 협의 * param : N/A * return : N/A */function recommend() {    // _sToken    //let _sToken = $('input[name=_sToken]').val();    // input에 담긴 query를 가져옴 (String)    let query = $('.searchQuery').val();	query = query.replace(/%/gi, '');	query = query.replace(/</gi, '');	query = query.replace(/>/gi, '');    // ajax에서 .do 호출 할 url : '/site/rest' (String)    let url = def.url;    // ajax에 사용할 contentType : 'application/x-www-form-urlencoded;charset=UTF-8' (String)    let contentType = def.contentType;    // gateway에 전달 시, 한글 깨짐 방지 (String)    let acQuery = encodeURI(query);    // openquery의 recommenc와 연동할 url 및 param (String)    let gatewayUrl = def.gatewayIpPort + '/service/related?keyword=' + acQuery;    // ajax로 가져온 data를 받음 (Array)    let resultArr = new Array();    // 화면에 뿌려질 html (String)    let html = '';    html += '<span class="box">추천검색어</span>';    // 추천검색어 데이터 가져오기.    $.ajax({        url: url,        type: 'POST',        contentType: contentType,        data: {            requestMethod: 'GET',            esUrl: gatewayUrl,            objData: "",            uriQuery: ""        },        async: false,        success: function(data) {			// 추출된 데이터가 하나도 없다면			if(data == '[]') {				html += '<a href="javascript:void(0)" onClick="javascript:acSearch(\'마포구청\'); return false;"><span>마포구청,</span></a>';				html += '<a href="javascript:void(0)" onClick="javascript:acSearch(\'마포\'); return false;"><span>마포,</span></a>';				html += '<a href="javascript:void(0)" onClick="javascript:acSearch(\'교육\'); return false;"><span>교육,</span></a>';				html += '<a href="javascript:void(0)" onClick="javascript:acSearch(\'복지\'); return false;"><span>복지,</span></a>';				html += '<a href="javascript:void(0)" onClick="javascript:acSearch(\'민원\'); return false;"><span>민원,</span></a>';				html += '<a href="javascript:void(0)" onClick="javascript:acSearch(\'여권\'); return false;"><span>여권</span></a>';			} else {				resultArr = JSON.parse(data);								// 화면에 뿌려질 데이터 구성.				for (var i in resultArr) {					html += '<a href="javascript:void(0)" onClick="javascript:acSearch(\'' + resultArr[i] + '\'); return false;"><span>';					// 추천검색어는 6개만 뿌려지며, 마지막 단어에는 콤마를 붙이지 않음.					if (i == (resultArr.length - 1) || i > 4) {						html += resultArr[i] + '</span></a>'; // 화면에 보여질 단어.						break;					} else {						html += resultArr[i] + ',</span></a>'; // 화면에 보여질 단어.					}				}			}			$('#recommUI').html(html);        },        error: function(err) {			$('#recommUI').html('');            console.error("err : " + err);        }    }); } /// end recommend()/* * 통합 마포구청 홈페이지 메인의 추천검색어. * param : N/A * return : N/A */function totalRecommend() {    // _sToken    //let _sToken = $('input[name=_sToken]').val();    // input에 담긴 query를 가져옴 (String)    let query = $('.totalQuery').val();    // ajax에서 .do 호출 할 url : '/site/rest' (String)    let url = def.url;    // ajax에 사용할 contentType : 'application/x-www-form-urlencoded;charset=UTF-8' (String)    let contentType = def.contentType;    // openquery의 popquery와 연동할 url 및 param (String)	// 통합 마포구청 홈페이지 메인의 추천검색어는, 진짜 추천검색어가 아닌, 인기검색어로 진행하도록 합의 됨    let gatewayUrl = def.gatewayIpPort + '/service/popquery?label=';    // 통합 마포구청 홈페이지 메인의 추천검색어 (String)    let gubun = 'recommend';    // ajax로 가져온 data를 받음 (Array)    let resultArr = null;    // 화면에 뿌려질 html (String)    let html = '';	let tempData = '';    html += '<span class="box">추천검색어 : </span>';	  // 통합페이지 추천검색어 데이터 가져오기.	$.ajax({		url: url,		type: 'POST',		contentType: contentType,		data: {			requestMethod: 'GET',			esUrl: gatewayUrl + gubun,			objData: "",			uriQuery: "#popQuery#"		},		async: false,		success: function(data) {			// 데이터 없을 때 출력하는 default data.			if (data == null || data == '' || data == undefined) {				html += '<a href="javascript:void(0)" onClick="javascript:totalRecommendSearch(\"마포구청\"); return false;"><span>마포구청,</span></a>';				html += '<a href="javascript:void(0)" onClick="javascript:totalRecommendSearch(\"마포\"); return false;"><span>마포,</span></a>';				html += '<a href="javascript:void(0)" onClick="javascript:totalRecommendSearch(\"복지\"); return false;"><span>복지,</span></a>';				html += '<a href="javascript:void(0)" onClick="javascript:totalRecommendSearch(\"교육\"); return false;"><span>교육</span></a>';				$('.txt_area').html(html);				return false;			} else {				resultArr = JSON.parse(data);			}						// 일정 크기를 넘어가면 데이터가 잘려버리는 것에 대응하기 위한 tempData			for(var i in resultArr) {				if(Number(byteCheck(tempData)) <= 35 ) {				  tempData += resultArr[i].query + ', ';				}			}			tempData = tempData.trim();			tempData = tempData.substring(0, tempData.length-1);			let tempArr = tempData.split(', ');			// 화면에 뿌려질 데이터 구성.			for(var i in tempArr) {				html += '<a href="javascript:void(0)" title="새창열림" onClick="javascript:totalRecommendSearch(\''+tempArr[i]+'\'); return false;"><span>';				if (i == (tempArr.length-1)) {				  html += tempArr[i] + ''; // 마지막엔 , 붙이지 않음				} else {				  html += tempArr[i] + ',';				}				html += '</span></a>';			}			$('#totalRecommend').html(html); 		},		error: function(err) {			$('#totalRecommend').html(''); 			console.error("err : " + err);		}	});} /// end recommend()/** * 통합페이지 추천검색어 바이트수 반환  * param : el(String) * return : codeByte(Number) */function byteCheck(el) {    var codeByte = 0;    for (var idx = 0; idx < el.length; idx++) {        var oneChar = escape(el.charAt(idx));        if (oneChar.length == 1) {            codeByte++;        } else if (oneChar.indexOf("%u") != -1) {            codeByte += 2;        } else if (oneChar.indexOf("%") != -1) {            codeByte++;        }    }    return codeByte;}function cutByteLength(str, len) {	if (str == null || str.length == 0) {		return 0;	}	var size = 0;	var rIndex = str.length;	for ( var i = 0; i < str.length; i++) {		size += this.charByteSize(str.charAt(i));		if( size == len ) {			rIndex = i + 1;			break;		} else if( size > len ) {			rIndex = i;			break;		}	}	return str.substring(0, rIndex);}function getByteLength(str) {	if (str == null || str.length == 0) {		return 0;	}	var size = 0;	for ( var i = 0; i < str.length; i++) {		size += this.charByteSize(str.charAt(i));	}	return size;}function charByteSize(ch) {	if (ch == null || ch.length == 0) {		return 0;	}	var charCode = ch.charCodeAt(0);	if (charCode <= 0x00007F) {		return 1;	} else if (charCode <= 0x0007FF) {		return 2;	} else if (charCode <= 0x00FFFF) {		return 3;	} else {		return 4;	}}/* * 통합페이지 자동완성. * param : query(String) * return : N/A * etc: javascript파일 내부에 넣어놓으면, I.E에서 인식을 못해서 빼놓음... */function totalAutoComplete(query) {	// 5자만 넘어가도 자동완성은 나오지 않음	if(query.length > 7) {		return false;	}		query = query.replace(/%/gi, '');	query = query.replace(/</gi, '&lt;');	query = query.replace(/>/gi, '&gt;');	    // _sToken    //let _sToken = $('input[name=_sToken]').val();    // ajax에서 .do 호출 할 url : '/site/rest' (String)    let url = def.url;    // ajax에 사용할 contentType : 'application/x-www-form-urlencoded;charset=UTF-8' (String)    let contentType = def.contentType;    // gateway에 전달 시, 한글 깨짐 방지 (String)    let acQuery = encodeURI(query);    // openquery의 autocomplete와 연동할 url 및 param (String)    let gatewayUrl = def.gatewayIpPort + '/service/autocomplete?keyword=' + acQuery + '&sort=weight';    // ajax로 가져온 data를 받음 (Array)    let resultArr = new Array();    // 화면에 뿌려질 html (String)    let html = '';    // 자동완성 데이터 가져오기.    $.ajax({        url: url,        type: 'POST',        contentType: contentType,        data: {            requestMethod: 'GET',            esUrl: gatewayUrl,            objData: "",            uriQuery: ""        },        async: false,        success: function(data) {            resultArr = JSON.parse(data);						// 데이터 화면에 뿌리기.			$.each(resultArr, function(index, item) {				html += '<li class="acClass"><a href="javascript:void(0);" title="새창" onClick="javascript:totalRecommendSearch(\'';				html += ((item.highlight).replace(/¶HS¶/gi, '')).replace(/¶HE¶/gi, ''); // acSearch()에 사용될 param				html += '\');"><span class="acText">';				html += ((item.highlight).replace(/¶HS¶/gi, '<HS>')).replace(/¶HE¶/gi, '</HS>'); // 화면에 보여질 data				html += '</span></a></li>';			});			$('#totalAutoCompleteUI').html(html);        },        error: function(err) {			$('#totalAutoCompleteUI').html('');            console.error("err : " + err);        }    });} /// end autoComplete()/**  * 통합페이지 추천검색어 클릭 시 검색 * param : query(String) * return : N/A */function totalRecommendSearch(query) {    $('.totalQuery').val(query);		query = decodeURI(query);    goSearch();}